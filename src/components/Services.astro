---
// Services section component
import { getTranslations } from "../utils/i18n";
import type { Locale } from "../utils/i18n";

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;
const t = getTranslations(locale);

const services = [
  {
    number: "01",
    titleKey: "services.webDev",
    descKey: "services.webDevDesc",
    icon: "globe",
  },
  {
    number: "02",
    titleKey: "services.mobileApps",
    descKey: "services.mobileAppsDesc",
    icon: "mobile",
  },
  {
    number: "03",
    titleKey: "services.apiDev",
    descKey: "services.apiDevDesc",
    icon: "api",
  },
  {
    number: "04",
    titleKey: "services.uiUx",
    descKey: "services.uiUxDesc",
    icon: "design",
  },
  {
    number: "05",
    titleKey: "services.consulting",
    descKey: "services.consultingDesc",
    icon: "consulting",
  },
  {
    number: "06",
    titleKey: "services.maintenance",
    descKey: "services.maintenanceDesc",
    icon: "maintenance",
  },
];
---

<section id="services" class="relative py-32 md:py-48">
  <!-- Subtle background pattern -->
  <div
    class="pointer-events-none absolute inset-0 overflow-hidden opacity-[0.015]"
  >
    <div
      class="absolute inset-0"
      style="background-image: radial-gradient(circle at 1px 1px, currentColor 1px, transparent 0); background-size: 48px 48px;"
    >
    </div>
  </div>

  <!-- Hat landing spot - decorative hook near heading (RIGHT on mobile, LEFT on desktop) -->
  <div
    data-hat-landing="services"
    class="absolute top-24 right-8 flex size-16 items-center justify-center sm:right-12 md:top-32 md:right-auto md:left-16"
  >
    <div
      class="border-strawhat-yellow size-4 rotate-45 border-r-2 border-b-2 opacity-60"
    >
    </div>
  </div>

  <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
    <div class="space-y-20">
      <!-- Section Header -->
      <div class="relative space-y-6">
        <div class="flex items-center gap-4">
          <div class="bg-strawhat-yellow h-px w-12"></div>
          <span
            class="text-strawhat-yellow text-sm font-medium tracking-widest uppercase"
            >{t("services.label")}</span
          >
        </div>
        <h2
          class="text-strawhat-text text-4xl/tight font-light tracking-tight md:text-6xl"
        >
          {t("services.title")}
        </h2>
        <p
          class="text-strawhat-text-light max-w-2xl text-lg/relaxed font-light"
        >
          {t("services.intro")}
        </p>
      </div>

      <!-- Services Grid -->
      <div class="services-grid grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {
          services.map((service) => (
            <article
              class="service-card group relative"
              style="perspective: 1000px;"
            >
              {/* Card container */}
              <div
                class="service-card-inner relative flex h-full flex-col rounded-2xl border border-zinc-200/60 bg-white/70 p-8 backdrop-blur-sm transition-all duration-300 hover:border-zinc-300/80 hover:bg-white/90 hover:shadow-xl hover:shadow-zinc-200/50 hover:backdrop-blur-xl hover:backdrop-saturate-150 dark:border-zinc-800/60 dark:bg-zinc-900/70 dark:hover:border-zinc-700/80 dark:hover:bg-zinc-900/90 dark:hover:shadow-zinc-900/50"
                style="transform-style: preserve-3d; will-change: transform;"
              >
                {/* Spotlight dim overlay - confined to card */}
                <div class="service-dim-overlay" />
                {/* Number & Icon row */}
                <div class="mb-6 flex items-start justify-between">
                  <span class="text-strawhat-yellow/40 group-hover:text-strawhat-yellow/70 text-5xl font-extralight tracking-tighter transition-colors duration-300">
                    {service.number}
                  </span>

                  {/* Minimal geometric icon */}
                  <div class="text-strawhat-text-light/40 group-hover:text-strawhat-yellow transition-colors duration-300">
                    {service.icon === "globe" && (
                      <svg
                        class="size-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="1.5"
                      >
                        <circle cx="12" cy="12" r="10" />
                        <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                      </svg>
                    )}
                    {service.icon === "mobile" && (
                      <svg
                        class="size-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="1.5"
                      >
                        <rect x="5" y="2" width="14" height="20" rx="2" />
                        <line x1="12" y1="18" x2="12" y2="18" />
                      </svg>
                    )}
                    {service.icon === "api" && (
                      <svg
                        class="size-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="1.5"
                      >
                        <path d="M4 6h16M4 12h16M4 18h16" />
                        <circle cx="8" cy="6" r="1" fill="currentColor" />
                        <circle cx="16" cy="12" r="1" fill="currentColor" />
                        <circle cx="10" cy="18" r="1" fill="currentColor" />
                      </svg>
                    )}
                    {service.icon === "design" && (
                      <svg
                        class="size-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="1.5"
                      >
                        <rect x="3" y="3" width="18" height="18" rx="2" />
                        <circle cx="8.5" cy="8.5" r="1.5" />
                        <path d="M21 15l-5-5L5 21" />
                      </svg>
                    )}
                    {service.icon === "consulting" && (
                      <svg
                        class="size-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="1.5"
                      >
                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" />
                      </svg>
                    )}
                    {service.icon === "maintenance" && (
                      <svg
                        class="size-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="1.5"
                      >
                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" />
                      </svg>
                    )}
                  </div>
                </div>

                {/* Content */}
                <div class="flex flex-1 flex-col space-y-4">
                  <h3 class="text-strawhat-text text-xl font-medium tracking-tight">
                    {t(service.titleKey)}
                  </h3>
                  <p class="text-strawhat-text-light flex-1 text-sm/relaxed font-light">
                    {t(service.descKey)}
                  </p>

                  {/* Subtle bottom accent */}
                  <div class="pt-4">
                    <div class="bg-strawhat-yellow/20 group-hover:bg-strawhat-yellow/40 h-px w-12 transition-all duration-300 group-hover:w-20" />
                  </div>
                </div>
              </div>
            </article>
          ))
        }
      </div>

      <!-- Bottom CTA area -->
      <div
        class="border-strawhat-text/10 flex flex-col items-center justify-between gap-6 border-t pt-12 sm:flex-row"
      >
        <p class="text-strawhat-text-light text-center text-sm sm:text-left">
          {t("services.ctaQuestion")}
        </p>
        <a
          href="#contact"
          class="group text-strawhat-text hover:text-strawhat-yellow inline-flex items-center gap-2 text-sm font-medium transition-colors"
        >
          {t("services.getInTouch")}
          <svg
            class="size-4 transition-transform duration-300 group-hover:translate-x-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M5 12h14M12 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
    </div>
  </div>
</section>

<style>
  .service-card {
    --card-delay: 0ms;
    --spot-x: 50%;
    --spot-y: 50%;
  }

  .service-card:nth-child(1) {
    --card-delay: 0ms;
  }
  .service-card:nth-child(2) {
    --card-delay: 50ms;
  }
  .service-card:nth-child(3) {
    --card-delay: 100ms;
  }
  .service-card:nth-child(4) {
    --card-delay: 150ms;
  }
  .service-card:nth-child(5) {
    --card-delay: 200ms;
  }
  .service-card:nth-child(6) {
    --card-delay: 250ms;
  }

  /* Mobile: add active state for touch */
  @media (max-width: 767px) {
    .service-card:active .service-card-inner {
      transform: scale(0.98);
    }
  }

  .service-card-inner {
    transform: rotateX(0deg) rotateY(0deg);
    transition:
      transform 0.15s ease-out,
      border-color 0.3s ease,
      box-shadow 0.3s ease;
  }

  /* Themed highlight glow that follows cursor - desktop only */
  .service-dim-overlay {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 100;
    border-radius: inherit;
    opacity: 0;
    transition: opacity 0.3s ease;
    background: radial-gradient(
      circle 150px at var(--spot-x) var(--spot-y),
      var(--strawhat-yellow) 0%,
      transparent 70%
    );
  }

  @media (min-width: 768px) {
    .service-card:hover .service-dim-overlay {
      opacity: 0.08;
    }
  }

  @media (prefers-reduced-motion: no-preference) {
    .service-card {
      animation: fadeInUp 0.6s ease-out both;
      animation-delay: var(--card-delay);
    }
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  // Desktop only - interactive effects
  if (window.innerWidth >= 768) {
    // Update highlight position on each service card
    const serviceCards = document.querySelectorAll(".service-card");

    serviceCards.forEach((card) => {
      card.addEventListener("mousemove", (e) => {
        const event = e as MouseEvent;
        const rect = card.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;
        (card as HTMLElement).style.setProperty("--spot-x", `${x}px`);
        (card as HTMLElement).style.setProperty("--spot-y", `${y}px`);
      });
    });

    // 3D tilt effect for service cards
    document.querySelectorAll(".service-card").forEach((card) => {
      const inner = card.querySelector(".service-card-inner") as HTMLElement;
      if (!inner) return;

      const maxTilt = 15; // Maximum tilt in degrees

      card.addEventListener("mousemove", (e) => {
        const event = e as MouseEvent;
        const rect = card.getBoundingClientRect();

        // Calculate mouse position relative to card center (0 to 1, then -0.5 to 0.5)
        const x = (event.clientX - rect.left) / rect.width - 0.5;
        const y = (event.clientY - rect.top) / rect.height - 0.5;

        // Calculate rotation (inverted so card tilts toward cursor)
        const rotateY = x * maxTilt; // Left/right tilt
        const rotateX = -y * maxTilt; // Up/down tilt (inverted)

        inner.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
      });

      card.addEventListener("mouseleave", () => {
        // Reset to flat
        inner.style.transform = "rotateX(0deg) rotateY(0deg)";
      });
    });
  }
</script>
