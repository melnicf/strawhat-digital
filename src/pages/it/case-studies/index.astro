---
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "../../../layouts/Layout.astro";
import Navbar from "../../../components/Navbar.astro";
import CaseStudyCard from "../../../components/CaseStudyCard.astro";
import Footer from "../../../components/Footer.astro";
import { getTranslations } from "../../../utils/i18n";
import { basePath } from "../../../utils/i18n";
import type { Locale } from "../../../utils/i18n";

type CaseStudy = CollectionEntry<"case-studies">;
const locale: Locale = "it";
const t = getTranslations(locale);
const base = basePath(locale);

const caseStudies = (await getCollection("case-studies")).sort(
  (a: CaseStudy, b: CaseStudy) => a.data.order - b.data.order
);
---

<Layout
  locale={locale}
  title={t("caseStudies.pageTitle")}
  description={t("caseStudies.pageDescription")}
>
  <Navbar locale={locale} pathname={Astro.url.pathname} />
  <section class="relative pt-32 pb-16 md:pt-48 md:pb-24">
    <div class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8">
      <div class="space-y-8">
        <a
          href={base || "/"}
          class="group text-strawhat-text-light hover:text-strawhat-yellow inline-flex items-center gap-2 text-sm transition-colors"
        >
          <svg
            class="size-4 transition-transform duration-300 group-hover:-translate-x-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"></path></svg
          >
          {t("caseStudies.backToHome")}
        </a>
        <div class="flex items-center gap-4">
          <div class="bg-strawhat-yellow h-px w-12"></div>
          <span
            class="text-strawhat-yellow text-sm font-medium tracking-widest uppercase"
            >{t("caseStudies.ourWork")}</span
          >
        </div>
        <h1
          class="text-strawhat-text text-4xl/tight font-light tracking-tight md:text-6xl"
        >
          {t("caseStudies.pageTitle")}
        </h1>
        <p
          class="text-strawhat-text-light max-w-2xl text-xl/relaxed font-light"
        >
          {t("caseStudies.pageDescription")}
        </p>
      </div>
    </div>
  </section>
  <section class="py-16 md:py-24">
    <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {
          caseStudies.map((study: CaseStudy) => (
            <CaseStudyCard
              slug={study.id}
              title={study.data.title}
              client={study.data.client}
              description={study.data.description}
              image={study.data.image}
              tags={study.data.tags}
              locale={locale}
            />
          ))
        }
      </div>
    </div>
  </section>
  <section class="border-strawhat-text/10 border-t py-16 md:py-24">
    <div class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col items-center justify-center gap-6 text-center">
        <h2
          class="text-strawhat-text text-2xl font-light tracking-tight md:text-3xl"
        >
          {t("caseStudies.readyToStart")}
        </h2>
        <p class="text-strawhat-text-light max-w-md text-base font-light">
          {t("caseStudies.letsDiscuss")}
        </p>
        <a
          href={`${base}/#get-started`}
          class="border-strawhat-yellow text-strawhat-yellow hover:border-strawhat-amber hover:text-strawhat-amber border-b-2 pb-2 text-lg font-light tracking-wider transition-all"
          >{t("caseStudies.getInTouch")}</a
        >
      </div>
    </div>
  </section>
  <Footer locale={locale} />
</Layout>

<script is:inline>
  (function () {
    if (window.innerWidth < 768) return;
    var c = document.querySelectorAll(".case-study-card");
    var m = 15;
    c.forEach(function (card) {
      if (card.__effectsInitialized) return;
      card.__effectsInitialized = true;
      var inner = card.querySelector(".card-inner");
      if (!inner) return;
      var rect = card.getBoundingClientRect();
      var rafId = null;
      var pending = false;
      var up = function (e) {
        if (!pending) {
          pending = true;
          rafId = requestAnimationFrame(function () {
            rect = card.getBoundingClientRect();
            var x = e.clientX - rect.left,
              y = e.clientY - rect.top;
            card.style.setProperty("--spot-x", x + "px");
            card.style.setProperty("--spot-y", y + "px");
            var xR = (e.clientX - rect.left) / rect.width - 0.5,
              yR = (e.clientY - rect.top) / rect.height - 0.5;
            inner.style.transform =
              "rotateX(" + -yR * m + "deg) rotateY(" + xR * m + "deg)";
            pending = false;
          });
        }
      };
      card.addEventListener("mousemove", up, { passive: true });
      card.addEventListener("mouseleave", function () {
        if (rafId !== null) cancelAnimationFrame(rafId);
        pending = false;
        inner.style.transform = "rotateX(0deg) rotateY(0deg)";
      });
      window.addEventListener(
        "resize",
        function () {
          rect = card.getBoundingClientRect();
        },
        { passive: true }
      );
    });
  })();
</script>
